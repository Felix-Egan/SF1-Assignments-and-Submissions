<!DOCTYPE html>
<html>
<head>
    <title>Python Coding Challenges</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .problem {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .editor {
            height: 600px;
            margin: 15px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .test-output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            margin-top: 15px;
            border: 1px solid #e9ecef;
        }
        button {
            padding: 10px 20px;
            margin: 10px 0;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        .test-case {
            margin: 10px 0;
            padding: 10px;
            border-left: 5px solid;
            background-color: #f8f9fa;
        }
        .test-case.pass {
            border-left-color: #28a745;
        }
        .test-case.fail {
            border-left-color: #dc3545;
        }
        .error {
            color: #dc3545;
            font-family: monospace;
            margin: 5px 0;
        }
        .summary {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }
        .passed { color: #28a745; }
        .failed { color: #dc3545; }
        .test-results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 14px;
        }

        .test-results-table th, 
        .test-results-table td {
            padding: 8px;
            text-align: left;
            border: 1px solid #ddd;
        }

        .test-results-table th {
            background-color: #f5f5f5;
            position: sticky;
            top: 0;
        }

        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .test-results-table tr.pass {
            background-color: rgba(40, 167, 69, 0.1);
        }

        .test-results-table tr.fail {
            background-color: rgba(220, 53, 69, 0.1);
        }

        .test-results-table td.truncate {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .test-results-table td.truncate:hover {
            white-space: normal;
            overflow: visible;
        }
    </style>
</head>
<body>
    <h1>Python Coding Challenges</h1>
    
    <div class="problem">
        <h2>1. Recipe Calculator üßë‚Äçüç≥</h2>
        <p>Help adjust recipe ingredients based on number of servings and convert between measurement units.</p>
        <div id="editor1" class="editor"></div>
        <button onclick="runTests(1)">Run Tests</button>
        <div class="test-output" id="output1"></div>
    </div>

    <div class="problem">
        <h2>2. Text Message Emoji Counter üì±</h2>
        <p>Analyze text messages to count emojis and calculate emoji density.</p>
        <div id="editor2" class="editor"></div>
        <button onclick="runTests(2)">Run Tests</button>
        <div class="test-output" id="output2"></div>
    </div>

    <div class="problem">
        <h2>3. Daily Task Scheduler ‚úÖ</h2>
        <p>Help organize daily tasks by priority and time management.</p>
        <div id="editor3" class="editor"></div>
        <button onclick="runTests(3)">Run Tests</button>
        <div class="test-output" id="output3"></div>
    </div>

    <script>
        // Initialize editors with default solutions
        const editors = {
            1: ace.edit("editor1"),
            2: ace.edit("editor2"),
            3: ace.edit("editor3")
        };

        const defaultSolutions = {
            1: `def scale_recipe(ingredients, servings):
    """
    Scale recipe ingredients based on desired servings.
    ingredients: list of [amount, unit, item]
    servings: int (desired number of servings)
    Returns: list of [scaled_amount, unit, item]
    """
    # Assuming original recipe is for 1 serving
    scaled = []
    for amount, unit, item in ingredients:
        scaled_amount = amount * servings
        scaled.append([scaled_amount, unit, item])
    return scaled

def convert_measurement(amount, from_unit, to_unit):
    """
    Convert between common cooking measurements.
    amount: float (amount to convert)
    from_unit: str (cups, tbsp, tsp)
    to_unit: str (cups, tbsp, tsp)
    Returns: float (converted amount)
    """
    # Conversion ratios
    conversions = {
        'cups': {'tbsp': 16, 'tsp': 48},
        'tbsp': {'cups': 1/16, 'tsp': 3},
        'tsp': {'cups': 1/48, 'tbsp': 1/3}
    }
    
    if from_unit == to_unit:
        return amount
    
    return amount * conversions[from_unit][to_unit]`,

            2: `def count_emojis(message):
    """
    Count number of emojis in a message.
    message: str (text message with emojis)
    Returns: int (number of emojis)
    """
    import re
    # Basic emoji pattern - this is simplified
    emoji_pattern = r'[\U0001F300-\U0001F9FF]'
    emojis = re.findall(emoji_pattern, message)
    return len(emojis)

def emoji_density(message):
    """
    Calculate percentage of characters that are emojis.
    message: str (text message with emojis)
    Returns: float (percentage between 0-100)
    """
    emoji_count = count_emojis(message)
    total_chars = len(message)
    if total_chars == 0:
        return 0
    return (emoji_count / total_chars) * 100`,

            3: `def estimate_duration(task, difficulty):
    """
    Estimate time needed for a task.
    task: str (task description)
    difficulty: int (1-5 scale)
    Returns: int (minutes needed)
    """
    # Base duration of 30 minutes per difficulty level
    return difficulty * 30

def sort_tasks(tasks):
    """
    Sort tasks by estimated duration.
    tasks: list of [task, difficulty]
    Returns: list of [task, duration]
    """
    # Convert difficulty to duration and sort
    task_durations = [[task, estimate_duration(task, diff)] for task, diff in tasks]
    return sorted(task_durations, key=lambda x: x[1])

def optimize_schedule(tasks, available_time):
    """
    Select tasks that fit within available time.
    tasks: list of [task, duration]
    available_time: int (minutes available)
    Returns: list of selected tasks
    """
    selected = []
    remaining_time = available_time
    
    for task, duration in sorted(tasks, key=lambda x: x[1]):
        if duration <= remaining_time:
            selected.append([task, duration])
            remaining_time -= duration
    
    return selected`
        };

        // Configure editors
        Object.values(editors).forEach((editor, index) => {
            editor.setTheme("ace/theme/crimson_editor");
            editor.session.setMode("ace/mode/python");
            editor.setFontSize(14);
            editor.setValue(defaultSolutions[index + 1], -1);
        });

        let pyodide = null;

        async function initPyodide() {
            if (!pyodide) {
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/"
                });
            }
            return pyodide;
        }

        
        async function testRecipeCalculator(pyodide) {
            return await pyodide.runPython(`
                import json
                test_cases = []
                
                # Test scaling recipe
                input_data = [[1, "cup", "flour"]], 2
                result = scale_recipe(*input_data)
                test_cases.append({
                    "description": "Scale recipe for double servings",
                    "input": input_data,
                    "passed": result == [[2, "cup", "flour"]],
                    "expected": [[2, "cup", "flour"]],
                    "actual": result
                })

                # Test measurement conversion
                input_data = 1, "cups", "tbsp"
                result = convert_measurement(*input_data)
                test_cases.append({
                    "description": "Convert 1 cup to tablespoons",
                    "input": input_data,
                    "passed": result == 16,
                    "expected": 16,
                    "actual": result
                })

                json.dumps({"cases": test_cases})
            `);
        }

        async function testEmojiCounter(pyodide) {
            return await pyodide.runPython(`
                import json
                test_cases = []
                
                # Test emoji counting
                input_data = "Hello üòäüåç"
                result = count_emojis("Hello üòäüåç")
                test_cases.append({
                    "description": "Count emojis in message",
                    "input": input_data,
                    "passed": result == 2,
                    "expected": 2,
                    "actual": result
                })

                # Test emoji density
                input_data = "Hello üòäüåç"
                result = emoji_density("Hello üòäüåç")
                test_cases.append({
                    "description": "Calculate emoji density",
                    "input": input_data,
                    "passed": abs(result - 25) < 0.1,
                    "expected": "~25%",
                    "actual": f"{result:.1f}%"
                })

                json.dumps({"cases": test_cases})
            `);
        }

        async function testTaskScheduler(pyodide) {
            return await pyodide.runPython(`
                import json
                test_cases = []
                
                # Test duration estimation
                input_data = "Write report", 3
                result = estimate_duration("Write report", 3)
                test_cases.append({
                    "description": "Estimate task duration",
                    input": input_data,
                    "passed": result == 90,
                    "expected": 90,
                    "actual": result
                })

                # Test task sorting
                input_data = [["Write report", 3], ["Quick email", 1]]
                result = sort_tasks([["Write report", 3], ["Quick email", 1]])
                test_cases.append({
                    "description": "Sort tasks by duration",
                    "input": input_data,
                    "passed": result == [["Quick email", 30], ["Write report", 90]],
                    "expected": [["Quick email", 30], ["Write report", 90]],
                    "actual": result
                })

                # Test schedule optimization
                input_data = [["Write report", 90], ["Quick email", 30]], 60
                result = optimize_schedule([["Write report", 90], ["Quick email", 30]], 60)
                test_cases.append({
                    "description": "Optimize schedule within time limit",
                    "input": input_data,
                    "passed": result == [["Quick email", 30]],
                    "expected": [["Quick email", 30]],
                    "actual": result
                })

                json.dumps({"cases": test_cases})
            `);
        }

        async function runTests(problemNumber) {
            const outputElement = document.getElementById(`output${problemNumber}`);
            outputElement.innerHTML = 'Initializing Python environment...';

            try {
                const pyodide = await initPyodide();
                const code = editors[problemNumber].getValue();
                
                // Execute the user's code
                await pyodide.runPython(code);

                // Run the appropriate test suite
                let testResults;
                switch(problemNumber) {
                    case 1:
                        testResults = await testRecipeCalculator(pyodide);
                        break;
                    case 2:
                        testResults = await testEmojiCounter(pyodide);
                        break;
                    case 3:
                        testResults = await testTaskScheduler(pyodide);
                        break;
                }

                // Parse the JSON string returned from Python
                testResults = JSON.parse(testResults);

                outputElement.innerHTML = formatTestResults(testResults);
            } catch (error) {
                outputElement.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                console.error(error);
            }
        }

        function formatTestResults(results) {
            if (!results || !results.cases) {
                return '<div class="error">Invalid test results</div>';
            }

            let html = '<div class="table-container"><table class="test-results-table">';
            
            // Add table header
            html += `
                <tr>
                    <th>#</th>
                    <th>Status</th>
                    <th>Description</th>
                    <th>Input</th>
                    <th>Expected</th>
                    <th>Actual</th>
                </tr>
            `;

            // Add test cases
            results.cases.forEach((test, index) => {
                const statusClass = test.passed ? 'pass' : 'fail';
                const icon = test.passed ? '‚úÖ' : '‚ùå';
                
                html += `
                    <tr class="${statusClass}">
                        <td>${index + 1}</td>
                        <td>${icon}</td>
                        <td class="truncate">${test.description}</td>
                        <td class="truncate">${JSON.stringify(test.input)}</td>
                        <td class="truncate">${JSON.stringify(test.expected)}</td>
                        <td class="truncate">${JSON.stringify(test.actual)}</td>
                    </tr>
                `;
            });

            html += '</table></div>';

            // Add summary footer
            const passedTests = results.cases.filter(t => t.passed).length;
            html += `
                <div class="summary" style="margin-top: 10px; font-weight: bold;">
                    Total: ${results.cases.length}  
                    <span class="passed">‚úÖ ${passedTests}</span>  
                    <span class="failed">‚ùå ${results.cases.length - passedTests}</span>
                </div>
            `;

            return html;
        }
    </script>
</body>
</html>